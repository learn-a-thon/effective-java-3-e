# ì•„ì´í…œ 39. ëª…ëª… íŒ¨í„´ë³´ë‹¤ ì• ë„ˆí…Œì´ì…˜ì„ ì‚¬ìš©í•˜ë¼

ê³¼ê±° í”„ë ˆì„ì›Œí¬ ë“±ì˜ í”„ë¡œê·¸ë¨ì€ ëª…ëª… íŒ¨í„´ì„ ì ìš©í•´ì™”ë‹¤. ì˜ˆì»¨ë° í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬ì¸ JUnit 3ì˜ ê²½ìš° í…ŒìŠ¤íŠ¸ ë©”ì„œë“œ ì´ë¦„ì„ testë¡œ ì‹œì‘í•˜ê²Œë” í–ˆë‹¤. ê·¸ëŸ¬ë‚˜ ëª…ëª… íŒ¨í„´ì€ ì—¬ëŸ¬ ë‹¨ì ì„ ê°€ì§„ë‹¤.

- ì˜¤íƒ€ê°€ ë‚˜ë©´ ì•ˆ ëœë‹¤.
- ì˜¬ë°”ë¥¸ í”„ë¡œê·¸ë¨ ìš”ì†Œì—ì„œë§Œ ì‚¬ìš©ë˜ë¦¬ë¼ ë³´ì¦í•  ë°©ë²•ì´ ì—†ë‹¤.
    - ë§Œì•½ ê°œë°œìê°€ TestMemberSaveë¼ëŠ” í´ë˜ìŠ¤ë¥¼ ì •ì˜í•˜ê³  í´ë˜ìŠ¤ì— ì •ì˜ëœ ë©”ì„œë“œë“¤ì„ í…ŒìŠ¤íŠ¸ í•˜ê¸¸ ê¸°ëŒ€í•œë‹¤ê³  í•˜ì. ê·¸ëŸ¬ë‚˜, JUnitì€ í´ë˜ìŠ¤ ì´ë¦„ì— ê´€ì‹¬ì´ ì—†ê¸° ë•Œë¬¸ì— ê°œë°œìê°€ ì˜ë„í•˜ëŠ” í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•  ìˆ˜ ì—†ë‹¤.
- í”„ë¡œê·¸ë¨ ìš”ì†Œë¥¼ ë§¤ê°œë³€ìˆ˜ë¡œ ì „ë‹¬í•  ë°©ë²•ì´ ì—†ë‹¤.
    - íŠ¹ì • ì˜ˆì™¸ë¥¼ ë˜ì ¸ì•¼ ì„±ê³µí•˜ëŠ” í…ŒìŠ¤íŠ¸ì˜ ê²½ìš°, ì˜ˆì™¸ íƒ€ì…ì„ í…ŒìŠ¤íŠ¸ ë©”ì„œë“œì— ë§¤ê°œë³€ìˆ˜ë¡œ ì „ë‹¬í•´ì•¼í•˜ëŠ” ìƒí™©ì´ë‹¤. ë©”ì„œë“œ ì´ë¦„ì— ì˜ˆì™¸ ì´ë¦„ì„ ì§€ì •í•˜ëŠ” ë°©ë²•ë„ ìˆì§€ë§Œ ê¹¨ì§€ê¸° ì‰½ê³  ì»´íŒŒì¼ëŸ¬ê°€ ì˜ˆì™¸ì¸ì§€ ì•Œ ìˆ˜ ì—†ëŠ” ë¬¸ì œê°€ìˆë‹¤.

ì• ë„ˆí…Œì´ì…˜[JLS, 9.7]ì€ ì´ ëª¨ë“  ë¬¸ì œë¥¼ í•´ê²°í•´ì¤€ë‹¤.

```java
/**
 * í…ŒìŠ¤íŠ¸ ë©”ì„œë“œì„ì„ ì„ ì–¸í•˜ëŠ” ì• ë„ˆí…Œì´ì…˜ì´ë‹¤.
 * ë§¤ê°œë³€ìˆ˜ ì—†ëŠ” ì •ì  ë©”ì„œë“œ ì „ìš©ì´ë‹¤.
 */
@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.METHOD)
public @interface Test {
}
```

- @Retention, @Targetê³¼ ê°™ì€ ì• ë„ˆí…Œì´ì…˜ì— ë‹¤ëŠ” ì• ë„ˆí…Œì´ì…˜ì€ ë©”íƒ€ì• ë„ˆí…Œì´ì…˜(meta-annotation)ì´ë¼ í•œë‹¤.
    - @Retentionì€ ëŸ°íƒ€ì„ì—ë„ ìœ ì§€ë˜ì–´ì•¼ í•œë‹¤ëŠ” í‘œì‹œ
    - @Targetì€ ë°˜ë“œì‹œ ë©”ì„œë“œ ì„ ì–¸ì—ë§Œ ì‚¬ìš©ë¼ì•¼ í•œë‹¤ëŠ” í‘œê¸°
- javax.annotation.processing API ë¬¸ì„œ ì°¸ê³ 

```java
// ì½”ë“œ 39-2 ë§ˆì»¤ ì• ë„ˆí…Œì´ì…˜ì„ ì‚¬ìš©í•œ í”„ë¡œê·¸ë¨ ì˜ˆ (239ìª½)
public class Sample {
    @Test
    public static void m1() {
    }        // ì„±ê³µí•´ì•¼ í•œë‹¤.

    public static void m2() {
    }

    @Test
    public static void m3() {    // ì‹¤íŒ¨í•´ì•¼ í•œë‹¤.
        throw new RuntimeException("ì‹¤íŒ¨");
    }

    public static void m4() {
    }  // í…ŒìŠ¤íŠ¸ê°€ ì•„ë‹ˆë‹¤.

    @Test
    public void m5() {
    }   // ì˜ëª» ì‚¬ìš©í•œ ì˜ˆ: ì •ì  ë©”ì„œë“œê°€ ì•„ë‹ˆë‹¤.

    public static void m6() {
    }

    @Test
    public static void m7() {    // ì‹¤íŒ¨í•´ì•¼ í•œë‹¤.
        throw new RuntimeException("ì‹¤íŒ¨");
    }

    public static void m8() {
    }
} 
```

- @Testì™€ ê°™ì´ â€œì•„ë¬´ ë§¤ê°œë³€ìˆ˜ ì—†ì´ ë‹¨ìˆœíˆ ëŒ€ìƒì— ë§ˆí‚¹(marking)í•œë‹¤â€ëŠ” ëœ»ì—ì„œ ë§ˆì»¤(marker) ì• ë„ˆí…Œì´ì…˜ì´ë¼ í•œë‹¤.
- @Test ì• ë„ˆí…Œì´ì…˜ì´ í´ë˜ìŠ¤ì— ì§ì ‘ì ì¸ ì˜í–¥ì„ ì£¼ì§€ëŠ” ì•ŠëŠ”ë‹¤.
    - ì¶”ê°€ì ì¸ ì •ë³´ë¥¼ ì œê³µí•  ë¿ì´ë‹¤.

```java
import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Method;

// ì½”ë“œ 39-3 ë§ˆì»¤ ì• ë„ˆí…Œì´ì…˜ì„ ì²˜ë¦¬í•˜ëŠ” í”„ë¡œê·¸ë¨ (239-240ìª½)
public class RunTests {
    public static void main(String[] args) throws Exception {
        int tests = 0;
        int passed = 0;
        Class<?> testClass = Class.forName(args[0]);
        for (Method m : testClass.getDeclaredMethods()) {
            if (m.isAnnotationPresent(Test.class)) {
                tests++;
                try {
                    m.invoke(null);
                    passed++;
                } catch (InvocationTargetException wrappedExc) {
                    Throwable exc = wrappedExc.getCause();
                    System.out.println(m + " ì‹¤íŒ¨: " + exc);
                } catch (Exception exc) {
                    System.out.println("ì˜ëª» ì‚¬ìš©í•œ @Test: " + m);
                }
            }
        }
        System.out.printf("ì„±ê³µ: %d, ì‹¤íŒ¨: %d%n", passed, tests - passed);
    }
}
```

- í•´ë‹¹ í´ë˜ìŠ¤ëŠ” ëª…ë ¹ì¤„ë¡œë¶€í„° ì™„ì „ ì •ê·œí™”ëœ í´ë˜ìŠ¤ ì´ë¦„ì„ ë°›ì•„, ê·¸ í´ë˜ìŠ¤ì—ì„œ @Test ì• ë„ˆí…Œì´ì…˜ì´ ë‹¬ë¦° ë©”ì„œë“œë¥¼ ì°¨ë¡€ë¡œ í˜¸ì¶œí•œë‹¤.

```java
import java.lang.annotation.ElementType;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
import java.lang.annotation.Target;

// ì½”ë“œ 39-4 ë§¤ê°œë³€ìˆ˜ í•˜ë‚˜ë¥¼ ë°›ëŠ” ì• ë„ˆí…Œì´ì…˜ íƒ€ì… (240-241ìª½)
/**
 * ëª…ì‹œí•œ ì˜ˆì™¸ë¥¼ ë˜ì ¸ì•¼ë§Œ ì„±ê³µí•˜ëŠ” í…ŒìŠ¤íŠ¸ ë©”ì„œë“œìš© ì• ë„ˆí…Œì´ì…˜
 */
@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.METHOD)
public @interface ExceptionTest {
    Class<? extends Throwable> value();
}
```

- íŠ¹ì • ì˜ˆì™¸ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ì• ë„ˆí…Œì´ì…˜ íƒ€ì… ì •ì˜
- Class<? extends Throwable>ì—ì„œ ì™€ì¼ë“œì¹´ë“œ íƒ€ì…ì€ â€œThrowableì„ í™•ì¥í•œ í´ë˜ìŠ¤ì˜ Class ê°ì²´â€ë¼ëŠ” ëœ»ì´ë©°, ë”°ë¼ì„œ ëª¨ë“  ì˜ˆì™¸(ì™€ ì˜¤ë¥˜) íƒ€ì…ì„ ë‹¤ ìˆ˜ìš©í•œë‹¤.
    - í•œì •ì  íƒ€ì… í† í°(ì•„ì´í…œ 33)ì˜ ë˜ í•˜ë‚˜ì˜ í™œìš© ì‚¬ë¡€ë‹¤.

```java
// ì½”ë“œ 39-5 ë§¤ê°œë³€ìˆ˜ í•˜ë‚˜ì§œë¦¬ ì• ë„ˆí…Œì´ì…˜ì„ ì‚¬ìš©í•œ í”„ë¡œê·¸ë¨ (241ìª½)
public class Sample2 {
    @ExceptionTest(ArithmeticException.class)
    public static void m1() {  // ì„±ê³µí•´ì•¼ í•œë‹¤.
        int i = 0;
        i = i / i;
    }

    @ExceptionTest(ArithmeticException.class)
    public static void m2() {  // ì‹¤íŒ¨í•´ì•¼ í•œë‹¤. (ë‹¤ë¥¸ ì˜ˆì™¸ ë°œìƒ)
        int[] a = new int[0];
        int i = a[1];
    }

    @ExceptionTest(ArithmeticException.class)
    public static void m3() {
    }  // ì‹¤íŒ¨í•´ì•¼ í•œë‹¤. (ì˜ˆì™¸ê°€ ë°œìƒí•˜ì§€ ì•ŠìŒ)
}
```

- íŠ¹ì • ì˜ˆì™¸ë¥¼ ì²˜ë¦¬í•˜ëŠ” ì• ë„ˆí…Œì´ì…˜ ì ìš© ì˜ˆì‹œ

```java
import item39.markerannotation.Test;
import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Method;

// ë§ˆì»¤ ì• ë„ˆí…Œì´ì…˜ê³¼ ë§¤ê°œë³€ìˆ˜ í•˜ë‚˜ì§œë¦¬ ì• ë„ˆíƒœì´ì…˜ì„ ì²˜ë¦¬í•˜ëŠ” í”„ë¡œê·¸ë¨ (241-242ìª½)
public class RunTests {
    public static void main(String[] args) throws Exception {
        int tests = 0;
        int passed = 0;
        Class<?> testClass = Class.forName(args[0]);
        for (Method m : testClass.getDeclaredMethods()) {
            if (m.isAnnotationPresent(Test.class)) {
                tests++;
                try {
                    m.invoke(null);
                    passed++;
                } catch (InvocationTargetException wrappedExc) {
                    Throwable exc = wrappedExc.getCause();
                    System.out.println(m + " ì‹¤íŒ¨: " + exc);
                } catch (Exception exc) {
                    System.out.println("ì˜ëª» ì‚¬ìš©í•œ @Test: " + m);
                }
            }

            if (m.isAnnotationPresent(ExceptionTest.class)) {
                tests++;
                try {
                    m.invoke(null);
                    System.out.printf("í…ŒìŠ¤íŠ¸ %s ì‹¤íŒ¨: ì˜ˆì™¸ë¥¼ ë˜ì§€ì§€ ì•ŠìŒ%n", m);
                } catch (InvocationTargetException wrappedEx) {
                    Throwable exc = wrappedEx.getCause();
                    Class<? extends Throwable> excType =
                            m.getAnnotation(ExceptionTest.class).value();
                    if (excType.isInstance(exc)) {
                        passed++;
                    } else {
                        System.out.printf(
                                "í…ŒìŠ¤íŠ¸ %s ì‹¤íŒ¨: ê¸°ëŒ€í•œ ì˜ˆì™¸ %s, ë°œìƒí•œ ì˜ˆì™¸ %s%n", m, excType.getName(), exc);
                    }
                } catch (Exception exc) {
                    System.out.println("ì˜ëª» ì‚¬ìš©í•œ @ExceptionTest: " + m);
                }
            }
        }

        System.out.printf("ì„±ê³µ: %d, ì‹¤íŒ¨: %d%n", passed, tests - passed);
    }
}
```

```java
import java.lang.annotation.ElementType;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
import java.lang.annotation.Target;

// ì½”ë“œ 39-6 ë°°ì—´ ë§¤ê°œë³€ìˆ˜ë¥¼ ë°›ëŠ” ì• ë„ˆí…Œì´ì…˜ íƒ€ì… (242ìª½)
@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.METHOD)
public @interface ExceptionTest {
    Class<? extends Exception>[] value();
}
```

- ì˜ˆì™¸ë¥¼ ì—¬ëŸ¬ ê°œ ëª…ì‹œí•˜ê³  ê·¸ì¤‘ í•˜ë‚˜ê°€ ë°œìƒí•˜ë©´ ì„±ê³µí•˜ë„ë¡ ë°°ì—´ë¡œ ì„ ì–¸

```java
import java.util.ArrayList;
import java.util.List;

// ë°°ì—´ ë§¤ê°œë³€ìˆ˜ë¥¼ ë°›ëŠ” ì• ë„ˆí…Œì´ì…˜ì„ ì‚¬ìš©í•˜ëŠ” í”„ë¡œê·¸ë¨ (242-243ìª½)
public class Sample3 {

    // ì½”ë“œ 39-7 ë°°ì—´ ë§¤ê°œë³€ìˆ˜ë¥¼ ë°›ëŠ” ì• ë„ˆí…Œì´ì…˜ì„ ì‚¬ìš©í•˜ëŠ” ì½”ë“œ (242-243ìª½)
    @ExceptionTest({IndexOutOfBoundsException.class,
            NullPointerException.class})
    public static void doublyBad() {   // ì„±ê³µí•´ì•¼ í•œë‹¤.
        List<String> list = new ArrayList<>();

        // ìë°” API ëª…ì„¸ì— ë”°ë¥´ë©´ ë‹¤ìŒ ë©”ì„œë“œëŠ” IndexOutOfBoundsExceptionì´ë‚˜
        // NullPointerExceptionì„ ë˜ì§ˆ ìˆ˜ ìˆë‹¤.
        list.addAll(5, null);
    }
}
```

```java
// ë°°ì—´ ë§¤ê°œë³€ìˆ˜ë¥¼ ë°›ëŠ” ì• ë„ˆí…Œì´ì…˜ì„ ì²˜ë¦¬í•˜ëŠ” ì½”ë“œ (243ìª½)
if (m.isAnnotationPresent(ExceptionTest.class)) {
    tests++;
    try {
        m.invoke(null);
        System.out.printf("í…ŒìŠ¤íŠ¸ %s ì‹¤íŒ¨: ì˜ˆì™¸ë¥¼ ë˜ì§€ì§€ ì•ŠìŒ%n", m);
    } catch (Throwable wrappedExc) {
        Throwable exc = wrappedExc.getCause();
        int oldPassed = passed;
        Class<? extends Throwable>[] excTypes =
                m.getAnnotation(ExceptionTest.class).value();
        for (Class<? extends Throwable> excType : excTypes) {
            if (excType.isInstance(exc)) {
                passed++;
                break;
            }
        }
        if (passed == oldPassed)
            System.out.printf("í…ŒìŠ¤íŠ¸ %s ì‹¤íŒ¨: %s %n", m, exc);
    }
}
```

```java
import java.lang.annotation.*;

// ì½”ë“œ 39-8 ë°˜ë³µ ê°€ëŠ¥í•œ ì• ë„ˆí…Œì´ì…˜ íƒ€ì… (243-244ìª½)
@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.METHOD)
@Repeatable(ExceptionTestContainer.class)
public @interface ExceptionTest {
    Class<? extends Throwable> value();
}
```

- ìë°” 8ì—ì„œëŠ” ì—¬ëŸ¬ ê°œì˜ ê°’ì„ ë°›ëŠ” ì• ë„ˆí…Œì´ì…˜ì„ ë‹¤ë¥¸ ë°©ì‹ìœ¼ë¡œë„ ë§Œë“¤ ìˆ˜ ìˆë‹¤.
    - ë°°ì—´ ë§¤ê°œë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ëŠ” ëŒ€ì‹  ì• ë„ˆí…Œì´ì…˜ì— @Repeatable ë§¤íƒ€ì• ë„ˆí…Œì´ì…˜ì„ ë‹¤ëŠ” ë°©ì‹ì´ë‹¤.

```java
// ë°˜ë³µ ê°€ëŠ¥í•œ ì• ë„ˆí…Œì´ì…˜ì˜ ì»¨í…Œì´ë„ˆ ì• ë„ˆí…Œì´ì…˜ (244ìª½)
@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.METHOD)
public @interface ExceptionTestContainer {
    ExceptionTest[] value();
}
```

- ë°˜ë³µ ê°€ëŠ¥ ì• ë„ˆí…Œì´ì…˜ì„ ì—¬ëŸ¬ ê°œ ë‹¬ë©´ í•˜ë‚˜ë§Œ ë‹¬ì•˜ì„ ë•Œì™€ êµ¬ë¶„í•˜ê¸° ìœ„í•´ í•´ë‹¹ â€˜ì»¨í…Œì´ë„ˆâ€™ ì• ë„ˆí…Œì´ì…˜ íƒ€ì…ì´ ì ìš©ëœë‹¤.

```java
// ì½”ë“œ 39-10 ë°˜ë³µ ê°€ëŠ¥ ì• ë„ˆí…Œì´ì…˜ ë‹¤ë£¨ê¸° (244-245ìª½)
if (m.isAnnotationPresent(ExceptionTest.class)
        || m.isAnnotationPresent(ExceptionTestContainer.class)) {
    tests++;
    try {
        m.invoke(null);
        System.out.printf("í…ŒìŠ¤íŠ¸ %s ì‹¤íŒ¨: ì˜ˆì™¸ë¥¼ ë˜ì§€ì§€ ì•ŠìŒ%n", m);
    } catch (Throwable wrappedExc) {
        Throwable exc = wrappedExc.getCause();
        int oldPassed = passed;
        ExceptionTest[] excTests =
                m.getAnnotationsByType(ExceptionTest.class);
        for (ExceptionTest excTest : excTests) {
            if (excTest.value().isInstance(exc)) {
                passed++;
                break;
            }
        }
        if (passed == oldPassed)
            System.out.printf("í…ŒìŠ¤íŠ¸ %s ì‹¤íŒ¨: %s %n", m, exc);
    }
}
```

- ë°˜ë³µ ê°€ëŠ¥ ì• ë„ˆí…Œì´ì…˜ì„ ì²˜ë¦¬í•˜ë„ë¡ ìˆ˜ì •í•œ ì½”ë“œ

<aside>
ğŸ’¡ ì• ë„ˆí…Œì´ì…˜ìœ¼ë¡œ í•  ìˆ˜ ìˆëŠ” ì¼ì„ ëª…ëª… íŒ¨í„´ìœ¼ë¡œ ì²˜ë¦¬í•  ì´ìœ ëŠ” ì—†ë‹¤.

</aside>